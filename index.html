<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='UTF-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <!-- <link rel='shortcut icon' href='images/logo.png'> -->
        <!-- <link rel='stylesheet' type='text/css' href='css/html5reset.css'> -->
        
        <!-- Bootstrap 5.3 https://getbootstrap.com/docs/5.3/getting-started/introduction -->
        <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH' crossorigin='anonymous'>
        <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js' integrity='sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz' crossorigin='anonymous'></script>
        
        <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
        <title>Labbing Web App</title>
        <style>
            body {
                background-color: rgb(200,200,200);
                overflow: hidden;
            }

            #display {
                font-size: 5.5vh;
                height: 85vh;
                line-height: 5.5vh;
            }

            #settingsButtonDiv {
                height: 10vh;
                text-align: end;
            }

            #labType {
                font-size: 3vh;
                height: 10vh;
            }

            #moveOneText {
                height: 18vh;
            }

            #modifierText {
                height: 18vh;
            }

            #moveTwoText {
                height: 18vh;
            }

            #randomizeButtonDiv {
                text-align: center;
            }

            #overlay {
                height: 85vh;
                background-color: rgb(225,225,225);
            }

            #about {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
                grid-template-areas:
                    'aspc abth abth abth abth clsb'
                    'abtx abtx abtx abtx abtx abtx';
            }
            
            #aboutHeaderSpacer {
                grid-area: aspc;
            }
            
            #aboutHeader {
                grid-area: abth;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            #closeAboutButtonDiv {
                grid-area: clsb;
                text-align: end;
            }
            
            #closeAboutButton {
                font-weight: bold;
            }
            
            #aboutText {
                grid-area: abtx;
                padding: 0 5vw;
                height: 78vh;
                overflow-y: scroll;
            }
            
            #config {
                display: none;
                grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
                grid-template-areas:
                    'abtd ottl ottl ottl ottl clsb'
                    'lbti lbti lbti lbti lbti lbti'
                    'movl movl movl modl modl modl'
                    'rndb rndb rndb rndb rndb rndb';
            }
            
            #aboutButtonDiv {
                grid-area: abtd;
            }
            
            #aboutButton {
                font-weight: bold;
            }
            
            #overlayTitle {
                grid-area: ottl;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            #overlayCloseButtonDiv {
                grid-area: clsb;
                text-align: end;
            }

            #overlayCloseButton {
                display: none;
                font-weight: bold;
            }

            #labTypeInput {
                grid-area: lbti;
                display: flex;
                justify-content: center;
            }

            .groupHeaderDiv {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.25rem;
            }

            .groupHeaderText {
                text-decoration-line: underline;
            }

            #moveList  {
                position: relative;
                grid-area: movl;
                background-color: rgb(190,190,190);
                max-height: 65vh;
                overflow-y: scroll;
            }

            #modifierList  {
                position: relative;
                grid-area: modl;
                background-color: rgb(190,190,190);
                max-height: 65vh;
                overflow-y: scroll;
            }

            .deactivateOverlay {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(125,125,125,0.5);
                z-index: 10;
            }

            .header {
                font-weight: bold;
                text-align: center;
            }

            .form-check-input:checked {
                background-color: rgb(108, 117, 125);
                border-color: rgba(0,0,0,0);
            }

            .form-check {
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .optionInput {
                flex-grow: 1;
                min-width: 0;
            }

            .removeOptionButton  {
                flex-shrink: 0;
            }

            div:has(> .addOptionButton) {
                text-align: center;
            }

            #overlayRandomizeButtonDiv {
                grid-area: rndb;
                text-align: center;
            }
        </style>
        <script>
            var type = 'single';
            
            var library = {
                'Footwork': [
                    'coffee grinder',
                    '2 step',
                    '3 step',
                    '4 step',
                    '6 step',
                    'shuffle',
                    'kickout',
                    'cc',
                    'zulu spin',
                    'pretzel',
                    'overunder / stepover',
                    // 'blender / leg-o-leg / deadleg', // https://youtube.com/watch?v=UcyMWoQwevk&t=9m
                ],
                'Freezes': [
                    'turtle',
                    'pilot',
                    'baby',
                    'chair',
                    'elbow',
                    'headstand',
                    'headbridge',
                    'airbaby',
                    'handstand',
                    'bridge',
                ],
                'Groundwork': [
                    'back cc',
                    'belly sweep',
                    'back stepover',
                ],
                'Powermoves': [
                    'windmill',
                    'swipe',
                    'flare',
                    'headswipe',
                    'airflare',
                    'critical',
                    '1990 / 2000',
                    'darkhammer / cricket / jackhammer',
                    'turtle spin / chair spin',
                    'headspin',
                    'halo',
                    'UFO',
                    'gremlin',
                    'boomerang',
                    'buddha',
                ]
            }

            var moves;
            //var moves = [
            //    'coffee grinder',
            //    '2 step',
            //    '3 step',
            //    '4 step',
            //    '6 step',
            //    'shuffle',
            //    'kickout',
            //    'cc',
            //    'zulu spin',
            //    'pretzel',
            //    'overunder / stepover',
            //    // 'blender / leg-o-leg / deadleg', // https://youtube.com/watch?v=UcyMWoQwevk&t=9m
            //]

            var modifiers = [
                'ascend / descend',
                'bend / straighten',
                'circle',
                'extend / retract',
                'grab',
                'hook',
                'jump',
                'knee',
                'slide',
                'spin / pivot',
                'stab',
                'subtract',
                'sweep / blender',
                'thread',
                'repeat',
                'reverse / flip / swap',
            ]

            var history = {
                'moves': [
                    '',
                    '',
                ],
                'modifiers': [
                    '',
                    '',
                ],
            }

            function expandCollapseMoveGroup(button, moveGroupDiv) {
                var formChecks = moveGroupDiv.querySelectorAll('.form-check');
                if (moveGroupDiv.classList.contains('expanded')) {
                    for (var i = 0; i < formChecks.length; i++) {
                        formChecks[i].style.display = 'none';
                    }
                    button.innerText = 'v';
                    moveGroupDiv.classList.remove('expanded');
                    moveGroupDiv.classList.add('collapsed');
                }
                else if (moveGroupDiv.classList.contains('collapsed')) {
                    for (var i = 0; i < formChecks.length; i++) {
                        formChecks[i].style.display = 'flex';
                    }
                    button.innerText = '⌃';
                    moveGroupDiv.classList.remove('collapsed');
                    moveGroupDiv.classList.add('expanded');
                }
            }

            function selectAll(input, moveGroupDiv) {
                var formCheckInputs = moveGroupDiv.querySelectorAll('.form-check-input');
                if (input.checked == false) {
                    for (var i = 0; i < formCheckInputs.length; i++) {
                        formCheckInputs[i].checked = false;
                    }
                }
                else if (input.checked == true) {
                    for (var i = 0; i < formCheckInputs.length; i++) {
                        formCheckInputs[i].checked = true;
                    }
                }
            }

            function populateLists() {
                var moveGroupDiv;
                var groupHeaderDiv;
                var groupHeaderText;
                var selectInputDiv;
                var selectInput;
                var expandButtonDiv;
                var expandButton;

                var formCheckDiv;
                var formCheckInput;
                var formCheckLabel;

                for (var key in library) {
                    moveGroupDiv = document.createElement('div');
                    moveGroupDiv.setAttribute('class', 'moveGroupDiv expanded');
                    groupHeaderDiv = document.createElement('div');
                    groupHeaderDiv.setAttribute('class', 'groupHeaderDiv');
                    expandButton = document.createElement('button');
                    expandButton.setAttribute('class', 'expandButton btn btn-sm');
                    expandButton.setAttribute('onclick', 'expandCollapseMoveGroup(this, this.parentElement.parentElement);');
                    expandButton.innerText = '⌃';
                    groupHeaderText = document.createElement('div');
                    groupHeaderText.setAttribute('class', 'groupHeaderText');
                    groupHeaderText.innerText = key;
                    selectInput = document.createElement('input');
                    selectInput.setAttribute('class', 'form-check-input');
                    selectInput.setAttribute('type', 'checkbox');
                    selectInput.setAttribute('checked', '');
                    selectInput.setAttribute('onchange','selectAll(this, this.parentElement.parentElement);');
                    groupHeaderDiv.appendChild(expandButton);
                    groupHeaderDiv.appendChild(groupHeaderText);
                    groupHeaderDiv.appendChild(selectInput);
                    moveGroupDiv.appendChild(groupHeaderDiv);
                    for (var i = 0; i < library[key].length; i++) {
                        formCheckDiv = document.createElement('div');
                        formCheckDiv.setAttribute('class', 'form-check');
                        formCheckInput = document.createElement('input');
                        formCheckInput.id = key.toLowerCase() + i;
                        formCheckInput.setAttribute('class', 'form-check-input');
                        formCheckInput.setAttribute('type', 'checkbox');
                        formCheckInput.setAttribute('checked', '');
                        // formCheckInput.setAttribute('onchange', 'updateList();');
                        formCheckLabel = document.createElement('label');
                        formCheckLabel.setAttribute('class', 'form-check-label');
                        formCheckLabel.setAttribute('for', key.toLowerCase() + i);
                        formCheckLabel.innerText = library[key][i];
                        formCheckDiv.appendChild(formCheckInput);
                        formCheckDiv.appendChild(formCheckLabel);
                        moveGroupDiv.appendChild(formCheckDiv);
                    }
                    document.getElementById('moveList').appendChild(moveGroupDiv);
                }
                
                var expandButtons = document.getElementsByClassName('expandButton');
                var groupHeaders = document.getElementsByClassName('groupHeaderDiv');
                for (var i = 1; i < expandButtons.length; i++) {
                    expandButtons[i].click();
                    groupHeaders[i].getElementsByClassName('form-check-input')[0].click();
                }
                
                formCheckDiv = document.createElement('div');
                formCheckInput = document.createElement('button');
                formCheckInput.setAttribute('class', 'addOptionButton btn btn-sm btn-secondary');
                formCheckInput.setAttribute('onclick','addOption(this.parentElement, this.parentElement.parentElement);');
                formCheckInput.innerText = '+';
                formCheckDiv.appendChild(formCheckInput);
                document.getElementById('moveList').appendChild(formCheckDiv);

                for (var i = 0; i < modifiers.length; i++) {
                    formCheckDiv = document.createElement('div');
                    formCheckDiv.setAttribute('class', 'form-check');
                    formCheckInput = document.createElement('input');
                    formCheckInput.id = 'modifier' + i;
                    formCheckInput.setAttribute('class', 'form-check-input');
                    formCheckInput.setAttribute('type', 'checkbox');
                    formCheckInput.setAttribute('checked', '');
                    // formCheckInput.setAttribute('onchange', 'updateList();');
                    formCheckLabel = document.createElement('label');
                    formCheckLabel.setAttribute('class', 'form-check-label');
                    formCheckLabel.setAttribute('for', 'modifier' + i);
                    formCheckLabel.innerText = modifiers[i];
                    formCheckDiv.appendChild(formCheckInput);
                    formCheckDiv.appendChild(formCheckLabel);
                    document.getElementById('modifierList').appendChild(formCheckDiv);
                }
                formCheckDiv = document.createElement('div');
                formCheckInput = document.createElement('button');
                formCheckInput.setAttribute('class', 'addOptionButton btn btn-sm btn-secondary');
                formCheckInput.setAttribute('onclick','addOption(this.parentElement, this.parentElement.parentElement);');
                formCheckInput.innerText = '+';
                formCheckDiv.appendChild(formCheckInput);
                document.getElementById('modifierList').appendChild(formCheckDiv);
            }

            function changeMode(mode) {
                document.getElementById('modeDropDown').innerText = mode.innerText;
                var moveListOverlay = document.getElementById('deactivateOverlayMoveList');
                var modifierListOverlay = document.getElementById('deactivateOverlayModifierList');
                switch (mode.innerText) {
                    case 'Move':
                        moveListOverlay.style.display = 'none';
                        modifierListOverlay.style.display = 'block';
                        break;
                    case 'Variation':
                        moveListOverlay.style.display = 'block';
                        modifierListOverlay.style.display = 'none';
                        break;
                    case 'Combination':
                        moveListOverlay.style.display = 'none';
                        modifierListOverlay.style.display = 'none';
                        break;
                    case 'Move Variation':
                        moveListOverlay.style.display = 'none';
                        modifierListOverlay.style.display = 'none';
                        break;
                    case 'Combination Variation':
                        moveListOverlay.style.display = 'none';
                        modifierListOverlay.style.display = 'none';
                        break;
                    default:
                        break;
                }
            }

            function addOption(buttonDiv, list) {
                var formCheckDiv = document.createElement('div');
                formCheckDiv.setAttribute('class', 'form-check');
                var formCheckInput = document.createElement('input');
                // formCheckInput.id = 'move' + i;
                formCheckInput.setAttribute('class', 'form-check-input');
                formCheckInput.setAttribute('type', 'checkbox');
                formCheckInput.setAttribute('checked', '');
                // formCheckInput.setAttribute('onchange', 'updateList();');
                var optionInput = document.createElement('input');
                optionInput.setAttribute('class', 'optionInput');
                optionInput.setAttribute('type', 'text');
                // optionInput.setAttribute('oninput', 'updateList();')
                var formCheckDivFour = document.createElement('button');
                formCheckDivFour.setAttribute('class', 'removeOptionButton btn btn-sm btn-dark');
                formCheckDivFour.setAttribute('onclick', 'removeOption(this.parentElement)');
                formCheckDivFour.innerText = '-';
                formCheckDiv.appendChild(formCheckInput);
                formCheckDiv.appendChild(optionInput);
                formCheckDiv.appendChild(formCheckDivFour);
                list.insertBefore(formCheckDiv, buttonDiv);
                // updateList();
            }

            function removeOption(option) {
                option.remove();
                // updateList();
            }

            function updateList() {
                moves = [];
                var moveList = document.getElementById('moveList').querySelectorAll('label, input[type="text"]');
                for (var i = 0; i < moveList.length; i++) {
                    if (moveList[i].tagName == 'LABEL') {
                        if (moveList[i].previousSibling.checked) {
                            moves[i] = moveList[i].innerText;
                        }
                    }
                    if (moveList[i].tagName == 'INPUT') {
                        if (moveList[i].previousSibling.checked) {
                            moves[i] = moveList[i].value;
                        }
                    }
                }
                moves = moves.filter(e => e);
                console.log(moves);

                modifiers = [];
                var modifierList = document.getElementById('modifierList').querySelectorAll('label, input[type="text"]');
                for (var i = 0; i < modifierList.length; i++) {
                    if (modifierList[i].tagName == 'LABEL') {
                        if (modifierList[i].previousSibling.checked) {
                            modifiers[i] = modifierList[i].innerText;
                        }
                    }
                    if (modifierList[i].tagName == 'INPUT') {
                        if (modifierList[i].previousSibling.checked) {
                            modifiers[i] = modifierList[i].value;
                        }
                    }
                }
                console.log(modifiers);
            }

            function openCloseAbout() {
                var about = document.getElementById('about');
                var config = document.getElementById('config');
                if (about.style.display != 'none') {
                    about.style.display = 'none';
                    config.style.display = 'grid';
                }
                else {
                    about.style.display = 'grid';
                    config.style.display = 'none';
                }
            }
            
            function openCloseOverlay() {
                var overlay = document.getElementById('overlay');
                var display = document.getElementById('display');
                if (overlay.style.display != 'none') {
                    overlay.style.display = 'none';
                    display.style.display = 'block';
                }
                else {
                    overlay.style.display = 'grid';
                    display.style.display = 'none';
                }
            }

            function randomize(location) {
                updateList();

                if (location == 'overlay') {
                    openCloseOverlay();
                }
                
                var mode = document.getElementById('modeDropDown').innerText;
                switch(mode) {
                    case 'Mode': // default to Move Variation
                    case 'Move Variation':
                        document.getElementById('labType').innerText = 'move variation';
                        document.getElementById('moveOneText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        document.getElementById('modifierText').innerText = modifiers[Math.floor(Math.random() * modifiers.length)];
                        document.getElementById('moveTwoText').innerText = '';
                        break;
                    case 'Move':
                        document.getElementById('labType').innerText = 'move';
                        document.getElementById('moveOneText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        document.getElementById('modifierText').innerText = '';
                        document.getElementById('moveTwoText').innerText = '';
                        break;
                    case 'Variation':
                        document.getElementById('labType').innerText = 'variation';
                        document.getElementById('moveOneText').innerText = '';
                        document.getElementById('modifierText').innerText = modifiers[Math.floor(Math.random() * modifiers.length)];
                        document.getElementById('moveTwoText').innerText = '';
                        break;
                    case 'Combination':
                        document.getElementById('labType').innerText = 'combination';
                        document.getElementById('moveOneText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        document.getElementById('modifierText').innerText = '';
                        document.getElementById('moveTwoText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        while (document.getElementById('moveOneText').innerText == document.getElementById('moveTwoText').innerText) {
                            document.getElementById('moveTwoText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        }
                        break;
                    case 'Combination Variation':
                        document.getElementById('labType').innerText = 'combination variation';
                        document.getElementById('moveOneText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        document.getElementById('modifierText').innerText = modifiers[Math.floor(Math.random() * modifiers.length)];
                        document.getElementById('moveTwoText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        while (document.getElementById('moveOneText').innerText == document.getElementById('moveTwoText').innerText) {
                            document.getElementById('moveTwoText').innerText = moves[Math.floor(Math.random() * moves.length)];
                        }
                        break;
                    default:
                        break;
                }
            }
        </script>
    </head>

    <body class='p-3' onload='populateLists();'>
        <div id='display' class='' style='display: none;'>
            <div id='settingsButtonDiv'>
                <button class='btn btn-md btn-secondary shadow' onclick='openCloseOverlay();'>⛭</button>
            </div>
            <div id='labType' class='text-center'>single variation</div>
            <div id='moveOneText' class='text-center'>coffee grinder</div>
            <div id='modifierText' class='text-center'>spin</div>
            <div id='moveTwoText' class='text-center'></div>
            <div id='randomizeButtonDiv'>
                <button id='randomizeButton' class='btn btn-lg btn-primary shadow' onclick='randomize();'>⟳</button>
            </div>
        </div>

        <div id='overlay' class='border border-secondary rounded shadow'>
            <div id='about'>
                <div id='aboutHeaderSpacer'></div>
                <div id='aboutHeader' class='header'>About this App</div>
                <div id='closeAboutButtonDiv'>
                    <button id='closeAboutButton' class='btn btn-md' onclick='openCloseAbout();'>X</button>
                </div>
                <div id='aboutText'>
                    <p>This is an app for labbing and practice.</p>
                    <p>In the config, the left column has a list of moves and the right column has a list of modifiers. The app selects from these lists to provide prompts for brainstorming variations or drilling moves. Use the '<b>+</b>' button at the bottom of each list to add custom moves or modifiers.</p>
                    <p>Use the '<b>Mode</b>' dropdown to choose what the app will return:
                        <br><u>Move</u>: a single move
                        <br><u>Variation</u>: a single modifier
                        <br><u>Combination</u>: a move to another move
                        <br><u>Move Variation</u>: a move with a modifier
                        <br><u>Combination Variation</u>: a move to another move with a modifier
                    </p>
                    <p>Use the checkboxes to include or exclude moves and modifiers from the selection. Use '<b>v</b>' or '<b>^</b>' to expand or collapse move sections.</p>
                    <p>After configuring, use '➜' at the bottom to run the randomizer. To randomize again, use '<b>⟳</b>' at the bottom. To change config, use '<b>⛭</b>' in the top right.</p>
                    <p>To close this about panel and go to the config panel, use the '<b>X</b>' in the top right.</p>
                    <p>To reopen this about panel, on the config panel use the '<b>(i)</b>' in the top left.</p>
                </div>
            </div>
            <div id='config'>
                <div id='aboutButtonDiv'>
                    <button id='aboutButton' class='btn btn-md' onclick='openCloseAbout();'>(i)</button>
                </div>
                <div id='overlayTitle'>
                    <div class='header'>Config</div>
                </div>
                <div id='overlayCloseButtonDiv'>
                    <button id='overlayCloseButton' class='btn btn-md' onclick='openCloseOverlay();'>X</button>
                </div>
                <div id='labTypeInput'>
                    <div class="dropdown">
                        <button class="btn dropdown-toggle" type="button" id="modeDropDown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Mode</button>
                        <div class="dropdown-menu" aria-labelledby="modeDropDown">
                            <a class="dropdown-item" onclick='changeMode(this);'>Move</a>
                            <a class="dropdown-item" onclick='changeMode(this);'>Variation</a>
                            <a class="dropdown-item" onclick='changeMode(this);'>Combination</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" onclick='changeMode(this);'>Move Variation</a>
                            <a class="dropdown-item" onclick='changeMode(this);'>Combination Variation</a>
                        </div>
                    </div>
                </div>
                <div id='moveList' class='rounded m-2 p-2'>
                    <div id='deactivateOverlayMoveList' class='deactivateOverlay' style='display: none;'></div>
                    <div class='header'>Moves</div>
                </div>
                <div id='modifierList' class='rounded m-2 p-2'>
                    <div id='deactivateOverlayModifierList' class='deactivateOverlay' style='display: none;'></div>
                    <div class='header'>Modifiers</div>
                </div>
                <div id='overlayRandomizeButtonDiv'>
                    <button class='btn btn-md btn-primary shadow m-2' onclick='randomize("overlay");'>➜</button>
                </div>
            </div>
        </div>
    </body>

</html>